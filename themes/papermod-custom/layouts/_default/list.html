{{ define "main" }}
{{ if .IsHome }}
<!-- HOMEPAGE - Wirecutter-style category sections -->
<div class="container home-content">
    {{ range $catName, $catPages := .Site.Taxonomies.categories }}
    {{ $pages := $catPages.Pages.ByDate.Reverse }}
    {{ if ge (len $pages) 1 }}
    <section class="category-section">
        <div class="category-section-header">
            <a href="/categories/{{ $catName | urlize }}/" class="category-label">{{ $catPages.Page.Title }}</a>
        </div>
        <div class="category-section-content">
            <!-- Featured article (first/newest) -->
            {{ with index $pages 0 }}
            <div class="featured-article">
                <a href="{{ .Permalink }}" class="featured-image">
                    {{ with .Params.cover.image }}
                    <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy">
                    {{ else }}
                    <div class="placeholder-image"></div>
                    {{ end }}
                </a>
                <div class="featured-info">
                    <h3 class="featured-title"><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
                    <p class="featured-byline">{{ with .Params.author }}By {{ . }} · {{ end }}Updated {{ .Date.Format "Jan. 2, 2006" }}</p>
                    <p class="featured-summary">{{ .Summary | plainify | truncate 180 }}</p>
                </div>
            </div>
            {{ end }}

            <!-- Side article list (next 2-3 posts) -->
            {{ if gt (len $pages) 1 }}
            <div class="article-list">
                {{ range after 1 (first 4 $pages) }}
                <div class="article-list-item">
                    <h4><a href="{{ .Permalink }}">{{ .Title }}</a></h4>
                    <p class="article-list-byline">{{ with .Params.author }}By {{ . }} · {{ end }}Updated {{ .Date.Format "Jan. 2, 2006" }}</p>
                </div>
                {{ end }}
            </div>
            {{ end }}
        </div>
    </section>
    {{ end }}
    {{ end }}

    <!-- Newsletter at very bottom -->
    <section class="newsletter-section">
        <h2>Get the Best Deals First</h2>
        <p>Join smart shoppers. We'll send you our top picks and price drops—no spam, ever.</p>
        <form class="newsletter-form" action="https://formspree.io/f/mykdgbyq" method="POST">
            <input type="email" name="email" placeholder="Enter your email" required>
            <button type="submit">Subscribe</button>
        </form>
        <p class="newsletter-note">Unsubscribe anytime. We respect your inbox.</p>
    </section>
</div>

{{ else }}
<!-- CATEGORY/SECTION PAGES -->
<div class="container">
    <header class="page-header">
        <h1>{{ .Title }}</h1>
        {{ with .Description }}<p>{{ . }}</p>{{ end }}
    </header>

    <div class="reviews-grid">
        {{ $paginator := .Paginate .Pages }}
        {{ range $paginator.Pages }}
        <article class="review-card">
            <a href="{{ .Permalink }}" class="review-card-image">
                {{ with .Params.cover.image }}
                <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy">
                {{ else }}
                <div style="width:100%;height:100%;background:var(--color-bg-alt);"></div>
                {{ end }}
            </a>
            <div class="review-card-content">
                {{ with .Params.categories }}
                <a href="/categories/{{ index . 0 | urlize }}/" class="review-card-category">{{ index . 0 }}</a>
                {{ end }}
                <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
                <p class="review-card-summary">{{ .Summary | truncate 120 }}</p>
                <div class="review-card-meta">
                    <span class="review-card-date">{{ .Date.Format "Jan 2, 2006" }}</span>
                </div>
            </div>
        </article>
        {{ end }}
    </div>

    {{ if gt $paginator.TotalPages 1 }}
    <nav class="pagination">
        {{ if $paginator.HasPrev }}
        <a href="{{ $paginator.Prev.URL }}">← Previous</a>
        {{ end }}
        {{ range $paginator.Pagers }}
        {{ if eq . $paginator }}
        <span class="active">{{ .PageNumber }}</span>
        {{ else }}
        <a href="{{ .URL }}">{{ .PageNumber }}</a>
        {{ end }}
        {{ end }}
        {{ if $paginator.HasNext }}
        <a href="{{ $paginator.Next.URL }}">Next →</a>
        {{ end }}
    </nav>
    {{ end }}
</div>
{{ end }}
{{ end }}
