{{ define "head" }}
{{/* Category/list page schema */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": {{ .Title | jsonify }},
  "description": {{ .Description | default .Site.Params.description | jsonify }},
  "url": "{{ .Permalink }}",
  "publisher": {
    "@type": "Organization",
    "name": "Researched Picks",
    "url": "{{ .Site.BaseURL }}"
  }
}
</script>
{{ end }}

{{ define "main" }}

{{/* ===== HOMEPAGE ===== */}}
{{ if .IsHome }}

<div class="home-layout">

  {{/* ===== LEFT: Main content ===== */}}
  <div class="home-main">

    {{/* Section label */}}
    <div class="section-label">Latest Reviews</div>

    {{/* Featured post — most recent */}}
    {{ $allPosts := where .Site.RegularPages "Section" "posts" }}
    {{ $featured := index $allPosts 0 }}
    {{ with $featured }}
    <div class="featured-post">
      {{ with .Params.cover.image }}
      <div class="featured-post-img">
        <a href="{{ $featured.Permalink }}">
          <img src="{{ . }}" alt="{{ $featured.Title }}" loading="eager" fetchpriority="high" width="600" height="400">
        </a>
      </div>
      {{ end }}
      <div class="featured-post-body">
        {{ with .Params.categories }}<div class="featured-post-cat">{{ index . 0 }}</div>{{ end }}
        <h2 class="featured-post-title">
          <a href="{{ .Permalink }}">{{ .Title }}</a>
        </h2>
        <p class="featured-post-excerpt">{{ .Summary | truncate 160 }}</p>
        <div class="featured-post-meta">
          By {{ .Params.author | default "Ben Arp" }} &middot; Updated {{ .Lastmod.Format "Jan. 2" }}
          {{ if .ReadingTime }} &middot; {{ .ReadingTime }} min read{{ end }}
        </div>
      </div>
    </div>
    {{ end }}

    {{/* Post grid — next 6 most recent */}}
    <div class="post-grid">
      {{ range first 6 (after 1 $allPosts) }}
      <a href="{{ .Permalink }}" class="post-card" style="text-decoration:none;">
        {{ with .Params.cover.image }}
        <div class="post-card-img">
          <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy" width="400" height="250">
        </div>
        {{ end }}
        <div class="post-card-body">
          {{ with .Params.categories }}<div class="post-card-cat">{{ index . 0 }}</div>{{ end }}
          <div class="post-card-title">{{ .Title }}</div>
          <div class="post-card-meta">
            {{ with .Params.rating }}<span class="post-card-rating">★ {{ . }}</span> &middot; {{ end }}
            {{ .Lastmod.Format "Jan. 2" }}
          </div>
        </div>
      </a>
      {{ end }}
    </div>

    {{/* Category sections */}}
    {{ $cats := slice "Electronics" "Kitchen Appliances" "Fitness & Health" "Home & Garden" "Beauty & Personal Care" "Office & Productivity" }}
    {{ range $cats }}
    {{ $cat := . }}
    {{ $catPages := where $allPosts ".Params.categories" "intersect" (slice $cat) }}
    {{ with $catPages }}
    <div class="cat-section">
      <div class="cat-section-header">
        <h2 class="cat-section-title">{{ $cat }}</h2>
        <a href="/categories/{{ $cat | urlize }}/" class="cat-section-link">See all →</a>
      </div>
      <div class="cat-post-list">
        {{ range first 4 . }}
        <div class="cat-post-item">
          {{ with .Params.cover.image }}
          <div class="cat-post-img">
            <a href="{{ $.Permalink }}">
              <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy" width="120" height="90">
            </a>
          </div>
          {{ end }}
          <div class="cat-post-body">
            <div class="cat-post-title"><a href="{{ .Permalink }}">{{ .Title }}</a></div>
            <div class="cat-post-meta">
              {{ with .Params.rating }}★ {{ . }} &middot; {{ end }}
              Updated {{ .Lastmod.Format "Jan. 2" }}
            </div>
          </div>
        </div>
        {{ end }}
      </div>
    </div>
    {{ end }}
    {{ end }}

  </div>

  {{/* ===== RIGHT: Sidebar ===== */}}
  <aside class="home-sidebar">

    {{/* Top Picks widget */}}
    <div class="sidebar-widget">
      <div class="sidebar-widget-title">Top Picks</div>
      <p style="font-size:0.875rem;color:var(--color-text-tertiary);margin-bottom:1rem;">Our research-backed recommendations</p>
      {{ $topCats := slice "Office & Productivity" "Fitness & Health" "Electronics" "Beauty & Personal Care" "Home & Garden" }}
      {{ range $topCats }}
      {{ $cat := . }}
      {{ $catPosts := where $allPosts ".Params.categories" "intersect" (slice $cat) }}
      {{ with $catPosts }}
      {{ $top := index . 0 }}
      <div style="margin-bottom:1.25rem;">
        <div style="font-size:0.6875rem;font-weight:700;text-transform:uppercase;letter-spacing:0.08em;color:var(--color-accent);margin-bottom:0.35rem;">{{ $cat }}</div>
        <a href="{{ $top.Permalink }}" style="font-size:0.875rem;font-weight:600;color:var(--color-text-primary);line-height:1.35;display:block;">
          {{ $top.Title | truncate 55 }}
        </a>
      </div>
      {{ end }}
      {{ end }}
    </div>

    {{/* Categories widget */}}
    <div class="sidebar-widget">
      <div class="sidebar-widget-title">Browse Categories</div>
      <div class="sidebar-category-list">
        {{ range .Site.Taxonomies.categories.Alphabetical }}
        <a href="{{ .Page.Permalink }}" class="sidebar-category-item">
          {{ .Page.Title }}
          <span class="sidebar-category-count">{{ .Count }}</span>
        </a>
        {{ end }}
      </div>
    </div>

  </aside>

</div>

{{/* Newsletter CTA */}}
<div class="newsletter-section">
  <div class="newsletter-inner">
    <h2 class="newsletter-title">Get Our Latest Picks</h2>
    <p class="newsletter-subtitle">New reviews and deals, straight to your inbox. No spam — just the good stuff.</p>
    <form class="newsletter-form" action="#" method="post">
      <input type="email" name="email" placeholder="Enter your email" required>
      <button type="submit" class="newsletter-btn">Subscribe</button>
    </form>
    <p class="newsletter-note">Unsubscribe anytime. We respect your inbox.</p>
  </div>
</div>

{{/* ===== CATEGORY / SECTION PAGE ===== */}}
{{ else }}

<div class="cat-page-header">
  <div class="cat-page-header-inner">
    <div class="cat-page-breadcrumb">
      <a href="/">Home</a> › <a href="/categories/">Categories</a> › {{ .Title }}
    </div>
    <h1 class="cat-page-title">{{ .Title }}</h1>
    {{ with .Description }}<p class="cat-page-desc">{{ . }}</p>{{ end }}
    <div class="cat-page-count">{{ len .Pages }} articles</div>
  </div>
</div>

<div class="container" style="padding-top:2rem;padding-bottom:3rem;">
  <div class="post-grid">
    {{ range .Paginator.Pages }}
    <a href="{{ .Permalink }}" class="post-card" style="text-decoration:none;">
      {{ with .Params.cover.image }}
      <div class="post-card-img">
        <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy" width="400" height="250">
      </div>
      {{ end }}
      <div class="post-card-body">
        {{ with .Params.categories }}<div class="post-card-cat">{{ index . 0 }}</div>{{ end }}
        <div class="post-card-title">{{ .Title }}</div>
        <div class="post-card-meta">
          {{ with .Params.rating }}<span class="post-card-rating">★ {{ . }}</span> &middot; {{ end }}
          {{ .Lastmod.Format "Jan. 2, 2006" }}
          {{ if .ReadingTime }} &middot; {{ .ReadingTime }} min{{ end }}
        </div>
      </div>
    </a>
    {{ end }}
  </div>

  {{/* Pagination */}}
  {{ if gt .Paginator.TotalPages 1 }}
  <nav class="pagination" aria-label="Pagination">
    {{ if .Paginator.HasPrev }}
    <a href="{{ .Paginator.Prev.URL }}" class="page-btn" rel="prev">← Prev</a>
    {{ end }}
    {{ range .Paginator.Pagers }}
    <a href="{{ .URL }}" class="page-btn {{ if eq . $.Paginator }}active{{ end }}">{{ .PageNumber }}</a>
    {{ end }}
    {{ if .Paginator.HasNext }}
    <a href="{{ .Paginator.Next.URL }}" class="page-btn" rel="next">Next →</a>
    {{ end }}
  </nav>
  {{ end }}
</div>
{{ end }}

{{ end }}
